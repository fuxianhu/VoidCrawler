#pragma once

#include <QString>
#include <QDir>
#include <QDateTime>
#include <QCoreApplication>
#include <string>
#include <type_traits>
#include <format>

namespace VoidCrawlerCore {

    template<typename StringType>
    inline QString getPath(const StringType& path) {
        QString qstr;
        if constexpr (std::is_same_v<StringType, std::string>) {
            qstr = QString::fromStdString(path);
        } else if constexpr (std::is_same_v<StringType, QString>) {
            qstr = path;
        } else {
            qstr = QString::fromUtf8(reinterpret_cast<const char*>(path));
        }

    #ifdef QT_DEBUG
        return QDir::currentPath() + "/" + qstr;
    #else
        return QCoreApplication::applicationDirPath() + "/" + qstr;
    #endif
    }

    class Version {
    public:
        const quint16 MAJOR, MINOR, PATCH, BUILD;
        const QString description_;
        const QDateTime buildTime_;

        Version(const quint16& major = 0,
                const quint16& minor = 0,
                const quint16& patch = 0,
                const quint16& build = 0,
                const QString& description = "",
                const QDateTime& buildTime = QDateTime::currentDateTimeUtc()) :
            MAJOR(major), MINOR(minor), PATCH(patch), BUILD(build), description_(description), buildTime_(buildTime)
        { }

        auto operator<=>(const Version& other) const {
            if (auto cmp = MAJOR <=> other.MAJOR; cmp != 0) return cmp;
            if (auto cmp = MINOR <=> other.MINOR; cmp != 0) return cmp;
            if (auto cmp = PATCH <=> other.PATCH; cmp != 0) return cmp;
            return BUILD <=> other.BUILD;
        }

        auto operator==(const Version& other) const {
            return MAJOR == other.MAJOR &&
                   MINOR == other.MINOR &&
                   PATCH == other.PATCH &&
                   BUILD == other.BUILD;
        }

        std::string toStdString() const {
            return std::format("v.{}.{}.{}.{}", MAJOR, MINOR, PATCH, BUILD);
        }

        QString toQString() const {
            return QString::fromStdString(toStdString());
        }
    };

    inline Version VoidCrawlerVersion = Version(0, 0, 0, 1, "First Version");
}
