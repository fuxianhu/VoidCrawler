#include "VoidCrawler.h"
#include <QApplication>
#include <QWidget>
#include <QGraphicsDropShadowEffect>
#include <QDir>
#include <QtWidgets/QPushButton>


VoidCrawler::VoidCrawler(QWidget *parent) : QMainWindow(parent)
{
    ui.setupUi(this);

    // 初始化多语言翻译器
	translator = new QTranslator(this);

	// 之后应该更改语言、初始化ui等
}

// 初始化UI界面函数
void VoidCrawler::initUI()
{
	//this->acceptDrops(); // 允许拖放文件，但这是很久以后的功能了
    this->setWindowFlags(Qt::FramelessWindowHint);
    this->resize(300, 800);
    this->setWindowTitle("VoidCrawler Client");
    this->setWindowIcon(QIcon(QDir::currentPath() + "/icon.ico"));
    QPalette palette;
    //设置主窗口背景颜色
    palette.setColor(QPalette::Window, QColor(0, 0, 0)); // 黑色
    this->setPalette(palette);

    // 为不同的控件创建独立的阴影效果实例（同一个 QGraphicsEffect 不能被多个控件共享）
    QGraphicsDropShadowEffect* windowShadow = new QGraphicsDropShadowEffect(this);
    windowShadow->setColor(QColor(138, 0, 255)); // 紫色
    windowShadow->setOffset(0, 0);
    windowShadow->setBlurRadius(200);
    this->setGraphicsEffect(windowShadow);

    // 创建第一个QLabel
    QLabel* firstLabel = new QLabel(tr("你好，世界！"), this);
    firstLabel->setStyleSheet("color: rgb(255, 255, 255); background: transparent;");
    // 确保标签背景透明，以便阴影能正确显示
    firstLabel->setAttribute(Qt::WA_TranslucentBackground, true);

    // 为 label 使用单独的阴影效果
    QGraphicsDropShadowEffect* labelShadow = new QGraphicsDropShadowEffect(firstLabel);
    labelShadow->setColor(QColor(138, 0, 255)); // 紫色
    labelShadow->setOffset(0, 0);
    labelShadow->setBlurRadius(30);
    firstLabel->setGraphicsEffect(labelShadow);

    firstLabel->setGeometry(50, 50, 200, 30);  // 设置位置和大小
    
    firstLabel->show();  // 显示QLabel

	QPushButton* btn = new QPushButton(tr("UAC ByPass"), this);
    // 为 button 使用单独的阴影效果
    QGraphicsDropShadowEffect* btnShadow = new QGraphicsDropShadowEffect(btn);
    btnShadow->setColor(QColor(138, 0, 255)); // 紫色
    btnShadow->setOffset(0, 0);
    btnShadow->setBlurRadius(30);
    btn->setGraphicsEffect(btnShadow);

    // 设置按钮颜色等属性
    //QPalette btnPalette = btn->palette();
    //btnPalette.setColor(QPalette::Button, QColor(255, 255, 255)); // 白色背景
    //btnPalette.setColor(QPalette::ButtonText, QColor(0, 0, 0));   // 黑色文字
    //btn->setPalette(btnPalette);

    btn->setGeometry(50, 100, 200, 30);  // 设置位置和大小
    
	btn->show();  // 显示QPushButton
}

VoidCrawler::~VoidCrawler()
{
    delete translator; // 虽然没有使用智能指针，但也是安全的
}

// 更改客户端语言，注意：更改语言后需要重新启动客户端以应用更改。（刚启动软件时除外）
void VoidCrawler::changeLanguage(const QString& language)
{
    // 卸载当前翻译器
    QApplication::removeTranslator(translator);

	// 加载新的翻译文件
    if (translator->load(QString(":/translations/%1.qm").arg(language)))
    {
		QApplication::installTranslator(translator);
    }
}