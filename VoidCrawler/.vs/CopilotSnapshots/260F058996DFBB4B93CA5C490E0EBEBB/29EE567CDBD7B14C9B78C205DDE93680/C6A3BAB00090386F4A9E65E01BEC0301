#include "VoidCrawler.h"
#include <QApplication>
#include <QWidget>
#include <QGraphicsDropShadowEffect>
#include <QGraphicsBlurEffect>
#include <QDir>
#include <QtWidgets/QPushButton>
#include <QFont>


VoidCrawler::VoidCrawler(QWidget *parent) : QMainWindow(parent)
{
    ui.setupUi(this);

    // 初始化多语言翻译器
	translator = new QTranslator(this);

	// 之后应该更改语言、初始化ui等
}

// 初始化UI界面函数
void VoidCrawler::initUI()
{
	//this->acceptDrops(); // 允许拖放文件，但这是很久以后的功能了
    this->setWindowFlags(Qt::FramelessWindowHint);
    this->resize(300, 800);
    this->setWindowTitle("VoidCrawler Client");
    this->setWindowIcon(QIcon(QDir::currentPath() + "/icon.ico"));

    // 将窗口主题色改为黑色
    this->setStyleSheet("QMainWindow { background-color: #000000; }");

    // 创建第一个QLabel（主文本）
    QLabel* firstLabel = new QLabel(tr("你好，世界！"), this);
    firstLabel->setStyleSheet("color: rgb(255, 255, 255); background: transparent; padding: 8px;");
    firstLabel->setFont(QFont("Microsoft YaHei", 14, QFont::Bold));
    firstLabel->setGeometry(30, 30, 240, 60);  // 增大位置和大小以容纳阴影

    // 创建一个位于主文本后面的标签作为发光层（紫色），并对其应用模糊效果
    QLabel* glowLabel = new QLabel(firstLabel->text(), this);
    glowLabel->setFont(firstLabel->font());
    // 使用半透明紫色作为发光颜色
    glowLabel->setStyleSheet("color: rgba(138, 0, 255, 200); background: transparent; padding: 8px;");
    // 与主标签位置一致，但可根据需要微调以获得更好的发光外观
    glowLabel->setGeometry(firstLabel->geometry());
    glowLabel->setAttribute(Qt::WA_TransparentForMouseEvents, true);

    // 使用模糊效果（不要与其他控件共享）
    QGraphicsBlurEffect* glowBlur = new QGraphicsBlurEffect(glowLabel);
    // 较大的模糊半径产生柔和的发光
    glowBlur->setBlurRadius(20);
    glowLabel->setGraphicsEffect(glowBlur);

    // 确保发光层位于主文本下面
    glowLabel->lower();
    firstLabel->raise();

    firstLabel->show();
    glowLabel->show();

    // 重新创建按钮并为其使用独立的阴影效果
    QPushButton* btn = new QPushButton(tr("UAC ByPass"), this);
    btn->setGeometry(50, 110, 200, 34);  // 设置位置和大小
    // 按钮使用深色背景以在黑色主题下保持可见
    btn->setStyleSheet("QPushButton { background-color: #111111; color: white; border: 1px solid #2c2c2c; border-radius: 4px; }");

    QGraphicsDropShadowEffect* btnShadow = new QGraphicsDropShadowEffect(btn);
    btnShadow->setColor(QColor(138, 0, 255, 180));
    btnShadow->setOffset(0, 0);
    // 按钮阴影更柔和但仍明显
    btnShadow->setBlurRadius(40);
    btn->setGraphicsEffect(btnShadow);

    btn->show();  // 显示QPushButton
}

VoidCrawler::~VoidCrawler()
{
    delete translator; // 虽然没有使用智能指针，但也是安全的
}

// 更改客户端语言，注意：更改语言后需要重新启动客户端以应用更改。（刚启动软件时除外）
void VoidCrawler::changeLanguage(const QString& language)
{
    // 卸载当前翻译器
    QApplication::removeTranslator(translator);

	// 加载新的翻译文件
    if (translator->load(QString(":/translations/%1.qm").arg(language)))
    {
		QApplication::installTranslator(translator);
    }
}